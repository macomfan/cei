<?xml version="1.0" encoding="UTF-8"?>
<sdk xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xsi:schemaLocation="https://github.com/macomfan/cei https://github.com/macomfan/cei/ceisdk.xsd"
     xmlns="https://github.com/macomfan/cei"
     name="test">

    <definition document="https://huobiapi.github.io/docs/spot/v1/en/"/>

    <models>
        <model name="ExchangeInfo">
            <string name="ExchangeName"/>
            <int name="Timestamp"/>
            <object_array name="Symbols" model="Symbols"/>
        </model>

        <model name="Symbols">
            <string name="Name"/>
            <string name="Status"/>
            <boolean name="OCOAllowed"/>
            <int name="Precision"/>
        </model>

        <model name="LastTrade">
            <decimal name="Price"/>
            <decimal name="Volume"/>
            <int name="Timestamp"/>
            <string name="Symbol"/>
        </model>

        <model name="Order">
            <int name="OrderId"/>
        </model>

        <model name="HistoricalTrade">
            <object_array name="data" model="TradeEntity"/>
        </model>

        <model name="TradeEntity">
            <decimal name="price"/>
            <decimal name="volume"/>
        </model>
    </models>

    <authentications>
        <restful name="restful">
            <get_now name="{timestamp}" format=""/>
            <add_query_string key="accessKeyId" value="{option.apiKey}"/>
            <add_query_string key="signatureMethod" value="HmacSHA256"/>
            <add_query_string key="signatureVersion" value="2"/>
            <add_query_string key="timestamp" value="{timestamp}"/>
            <combine_query_string name="{queryString}" sort="asc" separator="&amp;"/>
            <get_request_info name="{method}" info="method" convert="uppercase"/>
            <get_request_info name="{host}" info="host"/>
            <get_request_info name="{target}" info="target"/>
            <string_builder name="{buffer}">
                <add_string_item input="{method}"/>
                <add_string_item input="{host}"/>
                <add_string_item input="{target}"/>
                <add_string_item input="{queryString}"/>
                <combine_string_items separator="\n"/>
            </string_builder>
            <hmacsha256 name="{hmacsha256}" input="{buffer}" key="{option.secretKey}"/>
            <base64 name="{result}" input="{hmacsha256}"/>
            <add_query_string key="Signature" value="{result}"/>
        </restful>
    </authentications>

    <clients>
        <restful name="MarketClient">
            <connection url="https://api.huobipro.com"/>
            <interfaces>
                <interface name="getExchangeInfo">
                    <request method="get" target="/api/v1/exchangeInfo"/>
                    <response>
                        <json_parser model="ExchangeInfo">
                            <json_value copy="ExchangeName"/>
                            <json_value copy="Timestamp"/>
                            <json_object_array copy="Symbols" model="Symbols">
                                <json_value copy="Name"/>
                                <json_value copy="Status"/>
                                <json_value copy="OCOAllowed"/>
                                <json_value copy="Precision"/>
                            </json_object_array>
                        </json_parser>
                    </response>
                </interface>

                <interface name="getLastTrade">
                    <inputs>
                        <string name="symbol"/>
                    </inputs>
                    <request method="get" target="/api/v1/lastTrade">
                        <query_strings>
                            <query key="symbol" value="{symbol}"/>
                        </query_strings>
                    </request>
                    <response>
                        <json_parser model="LastTrade">
                            <json_value copy="Price"/>
                            <json_value copy="Volume"/>
                            <json_value copy="Timestamp"/>
                            <json_value copy="Symbol"/>
                        </json_parser>
                    </response>
                </interface>

                <interface name="placeOrder">
                    <inputs>
                        <string name="account_id"/>
                        <decimal name="price"/>
                    </inputs>
                    <request method="post" target="/api/v1/placeOrder">
                        <post_body value="{ts}">
                            <procedure>
								<get_now name="{ts}" format=""/>
                                <json_builder name="{jsonResult}">
                                    <json_string key="account-id" value="{account_id}"/>
                                    <json_decimal copy="price"/>
                                </json_builder>
                            </procedure>
                        </post_body>
                    </request>
                    <response>
                        <json_parser model="Order">
                            <json_value key="\[0]" value="{OrderId}"/>
                        </json_parser>
                    </response>
                </interface>
            </interfaces>
        </restful>

        <websocket name="WSClient">
            <connection>
                <inputs>
                    <string name="symbol"/>
                </inputs>
                <url target="ws"/>
                <on_connect>
                    <send value="{ts}">
                        <procedure>
                            <get_now name="{ts}" format=""/>
                            <json_builder name="{jsonResult}">
                                <json_value key="op" value="pong"/>
                                <json_value key="ts" value="{ts}"/>
                            </json_builder>
                        </procedure>
                    </send>
                </on_connect>
            </connection>
            <actions>
                <action name="onPing">
                    <trigger>
                        <json_checker>
                            <json_equal key="type" value="ping"/>
                        </json_checker>
                    </trigger>
                    <send value="{jsonResult}">
                        <procedure>
                            <get_now name="{ts}" format=""/>
                            <json_builder name="{jsonResult}">
                                <json_value key="op" value="pong"/>
                                <json_value key="ts" value="{ts}"/>
                            </json_builder>
                        </procedure>
                    </send>
                </action>
            </actions>
            <interfaces>
                <interface name="requestKline">
                    <inputs>
                        <string name="symbol"/>
                    </inputs>
                    <send value="{abc}">
                        <procedure>
                            <get_now name="{abc}" format=""/>
                        </procedure>
                    </send>
                    <callback name="onkline" persistent="false">
                        <trigger>
                            <json_checker>
                                <json_equal key="ch" value="{symbol}"/>
                            </json_checker>
                        </trigger>
                        <response>
                            <json_parser model="TradeEntity">
                                <json_value key="price" value="{price}"/>
                            </json_parser>
                        </response>
                    </callback>
                </interface>
            </interfaces>
        </websocket>
    </clients>
</sdk>